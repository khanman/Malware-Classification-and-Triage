# malware Classification and Triage

## Sample Execution

The data set used to evaluate my clustering system is located on my container at /usr/local/share/samples. A JSON document at /usr/local/share/samples.json indicates the arguments you should use to execute each sample, i choose strace to execute my samples and wrote to a file.

## Feature Extraction 
A script trace.py reads all the malware samples and creates a strace file for each sample.
Considering each syscall and the arguments as one feature. For each sample, i extracted a feature from the system call sequences and picked some system calls, calls mainly with string arguments and without a parameter.
Created a set of all system calls. Which will help is creating a finger print.

## Feature Hashing
Each feature  which is string,converted into a hash which helps to compute faster.
The set model created in step one used to create finger print. By comapring the set model againt the sample system calls and setting the value to 1 if it matchs else its zero.
after which i use the samples and apply pairwise Jaccard distance for all samples.

## Sample Clustering

After applying the Jaccard distance a martix is generated based on which wei cluster, i have used Machine learning library to  perform agglomerative hierarchical clustering on the fingerprint distance matrix. The result should be a dendrogram that indicates the sample clustering hierarchy.
The criterion choose to cluster set is jaccard similarity.

I used a threshold of 0.4 to identify a cut in the dendrogram that represents the most likely set of sample clusters.

Have added images for threshold of 0.4 and 0.3

Instructions:
Change the path of the samples in the args variable before running the script to generate the configuration.txt  file

 for i in j['samples']:
      #    print i['path'],"   ", i['args']
        args = ["strace","-f","-o",i['path']+".strace", "/home/adjacentmonitor/prset07/samples/"+i['path']]
        args.extend(i['args'])

Run ./trace.py
To generate the feature vector, written to configuration.txt file 
Name: configuration.txt
The configuration file contained a set of pre-computed feature vectors for each sample on the container. 
$ ./cluster configuration.txt

The output of my tool is most likely set of clusters in JSON format:
Ex:
{
    "clusters": [
        [<sample_c1_1>, 
	 <sample_c1_2>, 
	...],
        [<sample_c2_1>, 
	 <sample_c2_2>, 
	...],
        // ...
    ]
}
It prints the json on the console and creates a file name cluster-set.json which contains the samples

